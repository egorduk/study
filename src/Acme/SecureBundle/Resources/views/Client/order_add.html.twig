{% extends "AcmeSecureBundle::layout.html.twig" %}

{% block title "Create order" %}

    {% block content %}
        <style>
            .invalid{
                border-color: #E9322D!important;
                box-shadow: 0 0 6px #E9322D!important;
            }

            .popover {
                position: inherit;
                top: -30px !important;
                left: 310px !important;
            }
        </style>
        <div class="body">
            {% if (showWindow) %}
            <div id="success-window">
                <div class="Message Message--green" id="js-timer">
                    <div class="Message-icon">
                        <i class="fa fa-check"></i>
                    </div>
                    <div class="Message-body">
                        <p align="center">Ваш заказ создан! Ожидайте ставок авторов!</p>
                    </div>
                    <button class="Message-close js-messageClose"><i class="fa fa-times"></i></button>
                </div>
            </div>
            {% endif %}
            <div class="row" style="width: 500px">
                {{ form_start(formOrder, {'attr': {'class': 'form'}}) }}
                    {{ form_errors(formOrder) }}
                        <div class="form-group">
                            {{ form_label(formOrder.fieldTheme) }}
                            <div class="input-group">
                                {{ form_widget(formOrder.fieldTheme) }}
                                <span class="input-group-addon"><i class="icon-quill"></i></span>
                            </div>
                            {{ form_row(formOrder.fieldTask) }}
                            {{ form_label(formOrder.fieldDateExpire) }}
                            <div class="input-group">
                                {{ form_widget(formOrder.fieldDateExpire) }}
                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                            </div>
                            {{ form_label(formOrder.fieldOriginality) }}
                            <div class="input-group">
                                {{ form_widget(formOrder.fieldOriginality) }}
                                <span class="input-group-addon"><i class="icon-cc-pd"></i></span>
                            </div>
                            {{ form_label(formOrder.fieldCountSheet) }}
                            <div class="input-group">
                                {{ form_widget(formOrder.fieldCountSheet) }}
                                <span class="input-group-addon"><i class="icon-book"></i></span>
                            </div>
                            <div style="height: 60px">
                                {{ form_row(formOrder.selectorSubject) }}
                            </div>
                            <div style="height: 60px">
                                {{ form_row(formOrder.selectorTypeOrder) }}
                            </div>
                            <div style="height: 20px">
                            </div>
                            <div class="input-group">
                                <label for="formCreateOrder_create" class="btn btn-success"><i class="fa fa-pencil-square-o fa-2x">&nbspСоздать</i></label>
                                {{ form_widget(formOrder.create) }}
                                <label for="formCreateOrder_reset" class="btn btn-success"><i class="fa fa-trash-o fa-2x">&nbspОчистить</i></label>
                                {{ form_widget(formOrder.reset) }}
                            </div>
                            {{ form_row(formOrder.reset) }}
                        </div>
                {{ form_end(formOrder) }}
                <a href="{{ path('secure_client_profile', {'type': 'view'}) }}">К профилю</a>
            </div>
            <script>
                $(document).ready(function() {

                    /*$(document).on('focusin', function(e) {
                        if ($(e.target).closest(".mce-window").length) {
                            e.stopImmediatePropagation();
                        }
                    });*/

                    $('#formCreateOrder_fieldDateExpire').datepicker({
                        //autoclose: true,
                        todayHighlight: true,
                        todayBtn: true,
                        format: "dd/mm/yyyy"
                    })
                    .on('changeDate', function(ev) {
                        //$('.datepicker').hide();
                    });

                    $(".datepicker").css("width","225px");

                    $(".input-group-addon").click(function(e){
                        //$(".datepicker").show();
                    });

                    $("#formCreateOrder_selectorSubject").select2({
                        placeholder: "Выберите предмет",
                        allowClear: true,
                        width: 300,
                        maximumSelectionSize: 2,
                        formatNoMatches: "Не найден такой предмет",
                        sortResults: sortingResults
                    })
                    .on("select2-selecting", function(e) {
                        var selectorSubject = $("#formCreateOrder_selectorSubject");
                        hidePopover(selectorSubject);
                    });

                    $("#formCreateOrder_selectorTypeOrder").select2({
                        width: 300,
                        allowClear: true,
                        placeholder: "Выберите тип заказа",
                        formatNoMatches: "Не найден такой тип заказа",
                        maximumSelectionSize: 2,
                        sortResults: sortingResults
                    })
                    .on("select2-selecting", function(e) {
                        var selectorTypeOrder = $("#formCreateOrder_selectorTypeOrder");
                        hidePopover(selectorTypeOrder);
                    });

                    $('#formCreateOrder_create').click(function(e) {
                        var selectorSubject = $("#formCreateOrder_selectorSubject");
                        var selectorTypeOrder = $("#formCreateOrder_selectorTypeOrder");
                        triggerPopover(selectorSubject);
                        triggerPopover(selectorTypeOrder);
                        return true;
                    });

                    $('#formCreateOrder_reset').click(function(e) {
                        $("#formCreateOrder_selectorSubject, #formCreateOrder_selectorTypeOrder ").select2("val", "");
                        $("#formCreateOrder_selectorSubject, #formCreateOrder_selectorTypeOrder ").popover('hide');
                        $("#formCreateOrder_selectorSubject, #formCreateOrder_selectorTypeOrder ").removeClass('invalid');
                    });

                    function triggerPopover(a){
                        if (!a.val())
                        {
                            a.popover('show');
                            a.addClass('invalid');
                            $(".popover-title").css("color", "red" );
                            $(".popover").css("text-align", "center");
                        }
                        else
                        {
                            a.removeClass('invalid');
                            a.popover('hide');
                        }
                    }

                    $(".select2-choice").addClass("form-control");
                    $("#select2-chosen-1, #select2-chosen-2").css("line-height", "32px");

                    function hidePopover(a)
                    {
                        a.removeClass('invalid');
                        a.popover('hide');
                    }

                    function closeMessage(el) {
                        el.addClass('is-hidden');
                    }

                    $('.js-messageClose').on('click', function(e) {
                        closeMessage($(this).closest('.Message'));
                    });

                    setTimeout(function() {
                        closeMessage($('#js-timer'));
                    }, 3000);
                });
            </script>

            <script>
                tinyMCE.init({
                    mode : 'textareas',
                    width : 500,
                    height : 300,
                    language : 'ru',
                    plugins : "filemanager,safari,pagebreak,style,layer,table,save,advhr,advimage,advlink,emotions,iespell,inlinepopups,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras,template",
                    theme : "advanced",
                    theme_advanced_buttons1 : "insertfile,bold,italic,underline,strikethrough,formatselect,forecolor,backcolor,link,unlink,justifyleft,justifycenter,justifyright,bullist,numlist,|,pasteword,pastetext,table,image,|,undo,redo,|,code,fullscreen",
                    theme_advanced_buttons2 : "",
                    theme_advanced_buttons3 : "",
                    theme_advanced_toolbar_align : "left",
                    relative_urls : false
                });
            </script>
            <script type="text/javascript" src="{{ asset('bundles/js/sorting_select2.js') }}"></script>
        </div>
    {% endblock %}